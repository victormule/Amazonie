/* =========================================================
   Quai Branly – Memória & Alma
   Styles globaux (clean)
   ========================================================= */

/* ---------- Design tokens ---------- */
:root{
  --bg:#111;
  --text:#f5f5f5;
  --muted:#ccc;
  --accent:#f59e0b;        /* boutons par défaut */
  --publish:#ff6a00;       /* bouton "Publicar" (plus rouge) */
  --border:#444;
  --panel:#1a1a1a;
  --panel-2:#222;
  --soft:rgba(255,255,255,.06);
}

/* ---------- Base / reset doux ---------- */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  padding:2rem 1rem;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,sans-serif;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
img{ display:block; max-width:100%; height:auto; }
a{ color:inherit; text-decoration:none; }
h1{
  margin:0 0 3rem;
  font-size:2.5rem;
  letter-spacing:.05em;
  text-align:center;
}

/* ---------- Conteneur galerie ---------- */
#gallery{ max-width:1200px; margin-inline:auto; }

/* =========================================================
   Carte artefact (image + commentaires)
   ========================================================= */

/* Carte qui regroupe visuel + panneau pour une perception d’ensemble */
.artefact-card{
  margin:0 auto 2rem;
  background:#161616;
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  box-shadow:0 6px 22px rgba(0,0,0,.25);
}

/* Grille deux colonnes (image un peu plus large).
   Hauteur de ligne fixée => colonnes de même hauteur sur desktop. */
.artefact__grid{
  display:grid;
  grid-template-columns:1.1fr 1fr;
  gap:16px;
  align-items:stretch;
  height:clamp(420px, 60vh, 720px);
}

/* Colonne visuel */
.artefact__media{
  background:#000;
  border:1px solid var(--border);
  border-radius:10px;
  box-shadow:0 4px 16px rgba(0,0,0,.35);
  display:flex;
  align-items:center;
  justify-content:center;
  height:100%;
  min-height:0;
}
.artefact__media img{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
}

/* Panneau de commentaires / édition */
.panel{
  background:rgba(255,255,255,.03);
  border:1px solid var(--border);
  border-radius:10px;
  box-shadow:0 4px 16px rgba(0,0,0,.35);
  display:flex;
  flex-direction:column;
  height:100%;
  min-height:0; /* nécessaire pour que le scroll interne fonctionne */
}

/* Barre d’outils en haut (toggle Commentários/Escrever) */
.panel-toolbar{
  display:flex;
  justify-content:flex-end;
  gap:.5rem;
  padding:.45rem .7rem;
  border-bottom:1px solid var(--border);
}
.panel-toolbar .toggle-mode{
  background:transparent;
  border:1px solid var(--border);
  color:var(--text);
  padding:.35rem .65rem;
  font-size:.9rem;
  border-radius:6px;
  cursor:pointer;
}
.panel-toolbar .toggle-mode:hover{
  background:var(--accent);
  color:#000;
  border-color:var(--accent);
}

/* Liste des messages (zone scrollable) */
.panel-upper{
  flex:1 1 auto;
  overflow:auto;
  padding:1rem;
  scrollbar-width:thin;
  scrollbar-color:var(--border) transparent;
}
.panel-upper::-webkit-scrollbar{ width:8px; }
.panel-upper::-webkit-scrollbar-thumb{ background:var(--border); border-radius:8px; }

/* Zone d’édition (replie quand .panel.collapsed) */
.panel-lower{
  border-top:1px solid var(--border);
  padding:1rem;
  background:var(--panel-2);
  display:flex;
  flex-direction:column;
  gap:.6rem;
}
.panel.collapsed .panel-lower{ display:none; }
.panel.collapsed .panel-upper{ padding-top:.6rem; }

/* =========================================================
   Commentaires & prévisualisations
   ========================================================= */

.note{
  background:var(--soft);
  padding:.6rem .8rem;
  margin:0 0 .6rem;
  border-radius:6px;
  font-size:.95rem;
  border:1px solid transparent;
}
.note:hover{ border-color:var(--border); }

.note .comment-media{ margin:.4rem 0 .6rem; }
.note .comment-media img{
  max-width:100%;
  max-height:260px;
  object-fit:contain;
  border:1px solid var(--border);
  border-radius:4px;
  background:#000;
}

.preview{
  display:flex;
  align-items:center;
  gap:.6rem;
  flex-wrap:wrap;
  margin-top:.6rem;
}
.audio-preview,
.img-preview{
  display:flex;
  align-items:center;
  gap:.5rem;
}
.img-preview img{
  max-width:160px;
  max-height:120px;
  object-fit:contain;
  border:1px solid var(--border);
  border-radius:4px;
  background:#000;
}

/* =========================================================
   Formulaires & boutons
   ========================================================= */

textarea,
input[type="text"]{
  width:100%;
  background:#1f1f1f;
  color:var(--text);
  border:1px solid var(--border);
  border-radius:6px;
  padding:.55rem .7rem;
  outline:none;
}
textarea:focus,
input[type="text"]:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgb(245 158 11 / .15);
}
textarea{
  min-height:60px;
  max-height:200px;
  resize:vertical;
  overflow-x:hidden;
  white-space:pre-wrap;
  word-break:break-word;
  overflow-wrap:anywhere;
}
.char-count{
  font-size:.75rem;
  text-align:right;
  color:#aaa;
  margin-top:-6px;
}

.actions{
  display:flex;
  flex-wrap:wrap;
  gap:.6rem;
  margin-top:.25rem;
}
button{
  background:var(--accent);
  border:none;
  color:#000;
  padding:.5rem 1rem;
  border-radius:6px;
  font-weight:600;
  cursor:pointer;
  transition:filter .15s ease, transform .02s ease;
}
button:hover{ filter:brightness(1.05); }
button:active{ transform:translateY(1px); }
button[disabled]{ opacity:.6; cursor:not-allowed; }

/* Bouton “Publicar” distinct */
.actions [data-publish]{ background:var(--publish); }
.actions [data-publish]:hover{ filter:brightness(1.08); }

/* Bouton “écouter l’audio” (lazy) */
.play-audio{
  background:rgba(255,255,255,.1);
  color:var(--text);
  padding:.3rem .5rem;
  font-size:.85rem;
  border:1px solid var(--border);
}

/* Bouton “charger plus” */
.load-more-comments{
  display:block;
  width:100%;
  margin-top:1rem;
  background:rgba(255,255,255,.1);
  color:var(--text);
  border:1px solid var(--border);
}

/* Supprimer un message */
.delete-btn{
  background:transparent;
  color:#ff4d4d;
  border:1px solid #ff4d4d;
  font-size:.85rem;
  padding:.25rem .55rem;
  margin-top:.4rem;
  border-radius:4px;
}
.delete-btn:hover{ background:rgba(255,77,77,.12); }

/* Infos enregistrement */
.rec-info{
  font-size:.85rem;
  color:var(--muted);
  display:flex;
  align-items:center;
  gap:8px;
  padding:5px 0;
}
.size-warning{ color:#ff9a3c; }
.size-critical{ color:#ff4d4d; }

/* Loader */
#loading-indicator{
  text-align:center;
  padding:1rem;
  color:var(--accent);
  display:none;
}

/* Liens d’intro */
.privacy-link{ text-align:center; margin:0 0 1.2rem; }
.privacy-link a{
  border-bottom:1px dotted var(--border);
  font-size:.95rem;
}
.privacy-link a:hover{
  color:var(--accent);
  border-color:var(--accent);
}

/* =========================================================
   Modale carte (Leaflet)
   ========================================================= */

#map-modal{
  position:fixed; inset:0; z-index:9999;
  background:rgba(0,0,0,.78);
  display:none;                 /* togglé en JS */
  align-items:center;
  justify-content:center;
  padding:1rem;
}
.map-wrapper{
  display:flex;
  flex-direction:column;
  width:90%;
  max-width:720px;
  height:80vh;
  position:relative;
  background:#222;
  border:1px solid #555;
  border-radius:8px;
  overflow:hidden;
}
.map-banner{
  background:#333;
  color:#f5f5f5;
  padding:.7rem 1rem;
  text-align:center;
  font-weight:600;
  border-bottom:1px solid #555;
}
#leaflet-container{
  flex:1 1 auto;
  width:100%;
  height:auto;
  position:relative;
  z-index:1;
}
.map-btn{
  position:absolute;
  bottom:10px;
  padding:.45rem .9rem;
  background:var(--accent);
  color:#000;
  border:none;
  border-radius:6px;
  font-size:1rem;
  cursor:pointer;
  z-index:1500;
}
.map-btn:hover{ filter:brightness(1.06); }
#saveLoc{ left:10px; }
#closeMap{ right:10px; }

/* =========================================================
   Responsive
   ========================================================= */

@media (max-width:980px){
  .artefact__grid{
    grid-template-columns:1fr; /* empile */
    height:auto;               /* on relâche la hauteur contrainte */
    gap:.9rem;
  }
  .panel{ margin-top:.25rem; }
  .artefact__media{
    aspect-ratio:4/3;          /* visuel agréable en pile */
    max-height:66vh;
  }
}
@media (max-width:520px){
  .actions{ gap:.5rem; }
}

/* Accessibilité */
:where(button,a,input,textarea):focus-visible{
  outline:2px solid var(--accent);
  outline-offset:2px;
}
